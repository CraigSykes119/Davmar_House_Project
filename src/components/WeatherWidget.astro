---
// This part uses the environment variable from .env file
const apiKey = import.meta.env.VITE_WEATHER_API_KEY;
const lat = "51.940363"; // Latitude of Blarney
const lon = "-8.568047"; // Longitude of Blarney
const units = "metric"; // Units for temperature in Celsius

interface WeatherResponse {
  name: string;
  weather: { description: string; icon: string }[];
  main: { temp: number; humidity: number };
  wind: { speed: number };
}

// Fetch weather data from the OpenWeather API
const fetchWeather = async (): Promise<WeatherResponse | null> => {
  try {
    const response = await fetch(
      `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=${units}&appid=${apiKey}`
    );
    
    if (!response.ok) throw new Error("Failed to fetch weather data");

    return await response.json();
  } catch (error) {
    console.error("Error fetching weather data:", error);
    return null;
  }
};

// Fetch the weather data on the server side (Astro build process)
let data = await fetchWeather();
---

<!-- Weather Widget HTML -->
<div class="weather-container">
  {data ? (
    <>
      <h3>🌍 {data.name} Weather</h3>
      <img
        src={`https://openweathermap.org/img/wn/${data.weather[0].icon}@2x.png`}
        alt={data.weather[0].description}
      />
      <p>{data.weather[0].description}</p>
      <p>🌡️ {data.main.temp}°C</p>
      <p>💨 Wind speed: {data.wind.speed} m/s</p>
      <p>🌧️ Humidity: {data.main.humidity}%</p>
    </>
  ) : (
    <p>❌ Could not load weather data.</p>
  )}
</div>

<style>
  .weather-container {
    background: #ffffff;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    text-align: center;
    margin: 20px auto;
    width: 350px;
  }

  .weather-container h3 {
    font-size: 1.5rem;
    margin-bottom: 10px;
  }

  .weather-container img {
    width: 50px;
    height: 50px;
    margin: 10px 0;
  }
</style>
